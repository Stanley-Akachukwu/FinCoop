@page "/dashboard"
@layout AppUIMainLayout
@attribute [Authorize]
@using ChevronCoop.Web.AppUI.BlazorServer.Data
@inject IEntityDataService DataService
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider
@using System.Security.Claims;
@using ChevronCoop.Web.AppUI.BlazorServer.Pages.Accounts.DepositAccount.Drawals

<main>



    @* @if (isLoading)
    {
    <div class="flex items-center justify-center h-screen">
    <Spin size="large" />
    </div>
    }
    else*@

    <CurrentUserComp></CurrentUserComp>
    <div class="px-4 pt-6">
        <div class="mb-4">
            <nav class="flex mb-5" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-2">
                    <li class="inline-flex items-center">
                        <a href="/dashboard"
                           class="inline-flex items-center text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white">
                            <svg class="w-5 h-5 mr-2.5 text-gray-500 transition duration-75 group-hover:text-sidebar-icons-active active:text-sidebar-icons-active group"
                                 fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"></path>
                                <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"></path>
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                      clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </li>
                </ol>
            </nav>
        </div>
        @if (ShowGetStarted)
        {
            <div class="flex flex-row items-center justify-between p-4 rounded-lg mb-4 border border-yellow-500">

                <div class="flex flex-row items-center justify-between p-4 rounded-lg mb-4 border border-yellow-500" Visi>
                    <div class="flex items-center  gap-4  text-sm text-gray-500   dark:text-gray-300" role="alert">
                        <div>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path opacity="0.4" d="M21.76 15.92L15.36 4.4C14.5 2.85 13.31 2 12 2C10.69 2 9.49998 2.85 8.63998 4.4L2.23998 15.92C1.42998 17.39 1.33998 18.8 1.98998 19.91C2.63998 21.02 3.91998 21.63 5.59998 21.63H18.4C20.08 21.63 21.36 21.02 22.01 19.91C22.66 18.8 22.57 17.38 21.76 15.92Z" fill="#C27803" />
                                <path d="M12 14.75C11.59 14.75 11.25 14.41 11.25 14V9C11.25 8.59 11.59 8.25 12 8.25C12.41 8.25 12.75 8.59 12.75 9V14C12.75 14.41 12.41 14.75 12 14.75Z" fill="#C27803" />
                                <path d="M12 18.0001C11.94 18.0001 11.87 17.9901 11.8 17.9801C11.74 17.9701 11.68 17.9501 11.62 17.9201C11.56 17.9001 11.5 17.8701 11.44 17.8301C11.39 17.7901 11.34 17.7501 11.29 17.7101C11.11 17.5201 11 17.2601 11 17.0001C11 16.7401 11.11 16.4801 11.29 16.2901C11.34 16.2501 11.39 16.2101 11.44 16.1701C11.5 16.1301 11.56 16.1001 11.62 16.0801C11.68 16.0501 11.74 16.0301 11.8 16.0201C11.93 15.9901 12.07 15.9901 12.19 16.0201C12.26 16.0301 12.32 16.0501 12.38 16.0801C12.44 16.1001 12.5 16.1301 12.56 16.1701C12.61 16.2101 12.66 16.2501 12.71 16.2901C12.89 16.4801 13 16.7401 13 17.0001C13 17.2601 12.89 17.5201 12.71 17.7101C12.66 17.7501 12.61 17.7901 12.56 17.8301C12.5 17.8701 12.44 17.9001 12.38 17.9201C12.32 17.9501 12.26 17.9701 12.19 17.9801C12.13 17.9901 12.06 18.0001 12 18.0001Z" fill="#C27803" />
                            </svg>
                        </div>
                        <div class="flex flex-col gap-1">
                            <h2 class="font-semibold">Verify your account</h2>
                            <h2>Kindly provide the requested information to fully verify your account.</h2>
                        </div>
                    </div>
                    <form action="/get-started">
                        <button type="submit" class="inline-flex items-center p-3 text-sm font-normal text-center text-white rounded-lg bg-green-500 hover:bg-green-700 focus:ring-4 focus:ring-green-300 sm:ml-auto dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">
                            Get started
                        </button>
                    </form>

                </div>

            </div>
        }

        <CarouselComp></CarouselComp>


        <div class="grid grid-cols-1 gap-2 mt-4 w-full md:grid-cols-2 xl:grid-cols-4">

            <div class="p-4 bg-white rounded-lg shadow sm:p-6 xl:p-4">
                <div class="flex flex-row items-center gap-x-3 py-4">
                    @((MarkupString)SvgHelpers.DashboardWallet)

                    <div class="flex flex-col justify-start">
                        <div class="text-gray-500 text-sm">@DepositProductType.SAVINGS.ToString()</div>
                        <div class="text-base font-bold">
                            <AmountComp amount="savingsAccount" symbol="₦"></AmountComp>
                            
                        </div>
                    </div>
                </div>

                <!-- Card Footer -->
               
            </div>


            <div class="p-4 bg-white rounded-lg shadow sm:p-6 xl:p-4">
                <div class="flex flex-row items-center gap-x-3 py-4">

                    @((MarkupString)SvgHelpers.DashboardWallet)

                    <div class="flex flex-col justify-start">
                        <div class="text-gray-500 text-sm">@DepositProductType.SPECIAL_DEPOSIT.ToString().Replace("_", " ")</div>
                        <div class="text-base font-bold">
                           
                            <AmountComp amount="@SpecialDepositAccount" symbol="₦"></AmountComp>
                        </div>
                    </div>
                </div>

            </div>


            <div class="p-4 bg-white rounded-lg shadow sm:p-6 xl:p-4">
                <div class="flex flex-row items-center gap-x-3 py-4">

                    @((MarkupString)SvgHelpers.DashboardWallet)

                    <div class="flex flex-col justify-start">
                        <div class="text-gray-500 text-sm">@DepositProductType.FIXED_DEPOSIT.ToString().Replace("_", " ")</div>
                        <div class="text-base font-bold">
                            
                            <AmountComp amount="@FixedDepositAccount" symbol="₦"></AmountComp>

                        </div>
                    </div>
                </div>

                <!-- Card Footer -->
               
            </div>

            <div class="p-4 bg-white rounded-lg shadow sm:p-6 xl:p-4">
                <div class="flex flex-row items-center gap-x-3 py-4">

                    @((MarkupString)SvgHelpers.DashboardWallet)

                    <div class="flex flex-col justify-start">
                        <div class="text-gray-500 text-sm">Loans</div>
                        <div class="text-base font-bold">

                            <AmountComp amount="@_LoanAccountMasterView.Sum(x => x.PrincipalBalanceAccountId_LedgerBalance)" symbol="₦"></AmountComp>

                        </div>
                    </div>
                </div>

                <!-- Card Footer -->

            </div>
            
        </div>

        @if (CustomerId != null)
        {

            <div class="grid grid-cols-1 my-4 gap-2  md:grid-cols-2 ">
                <div class="flex flex-row justify-between items-center p-4 mb-4 bg-white rounded-lg shadow sm:p-6 xl:p-4  xl:mb-0">
                    <div class="mb-4">
                        <h3 class="mb-3 text-lg font-bold text-gray-800 dark:text-white">
                            Open a deposit account
                        </h3>
                        <p class="text-sm font-normal text-gray-500 dark:text-gray-400">

                            You can open a savings account, special deposit account or a <br />fixed deposit account from our
                            portfolio of deposit products

                        </p>

                        <NavLink href="/account/NewDepositApplication">
                            <button class="mt-4 py-2 px-8 w-full text-xs font-medium text-center text-white rounded-lg bg-CEMCS-Blue-100 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
                                Apply Now
                            </button>
                        </NavLink>
                    </div>

                    <!-- Card Footer -->

                    <svg width="100" height="100" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="60" cy="60" r="60" fill="#1F82BD" fill-opacity="0.2" />
                        <path d="M36 36C33.8783 36 31.8434 36.8429 30.3431 38.3431C28.8429 39.8434 28 41.8783 28 44V48H92V44C92 41.8783 91.1571 39.8434 89.6569 38.3431C88.1566 36.8429 86.1217 36 84 36H36Z"
                              fill="#1F82BD" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                              d="M92 56H28V76C28 78.1217 28.8429 80.1566 30.3431 81.6569C31.8434 83.1571 33.8783 84 36 84H84C86.1217 84 88.1566 83.1571 89.6569 81.6569C91.1571 80.1566 92 78.1217 92 76V56ZM36 72C36 70.9391 36.4214 69.9217 37.1716 69.1716C37.9217 68.4214 38.9391 68 40 68H44C45.0609 68 46.0783 68.4214 46.8284 69.1716C47.5786 69.9217 48 70.9391 48 72C48 73.0609 47.5786 74.0783 46.8284 74.8284C46.0783 75.5786 45.0609 76 44 76H40C38.9391 76 37.9217 75.5786 37.1716 74.8284C36.4214 74.0783 36 73.0609 36 72ZM56 68C54.9391 68 53.9217 68.4214 53.1716 69.1716C52.4214 69.9217 52 70.9391 52 72C52 73.0609 52.4214 74.0783 53.1716 74.8284C53.9217 75.5786 54.9391 76 56 76H60C61.0609 76 62.0783 75.5786 62.8284 74.8284C63.5786 74.0783 64 73.0609 64 72C64 70.9391 63.5786 69.9217 62.8284 69.1716C62.0783 68.4214 61.0609 68 60 68H56Z"
                              fill="#1F82BD" />
                    </svg>
                </div>

                <div class="flex flex-row justify-between items-center p-4 mb-4 bg-white rounded-lg shadow sm:p-6 xl:p-4  xl:mb-0">
                    <div class="mb-4">
                        <h3 class="mb-3 text-lg font-bold text-gray-800 dark:text-white">
                            Apply for a new loan
                        </h3>
                        <p class="text-sm font-normal text-gray-500 dark:text-gray-400">
                            Apply for target and executive loan from out portfolio of loan <br />products
                        </p>

                        <NavLink href="/account/loanproductsapplications">

                            <button class="mt-4 py-2 px-8 w-full text-xs font-medium text-center text-white rounded-lg bg-CEMCS-Blue-100 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
                                Apply Now
                            </button>
                        </NavLink>
                    </div>

                    <!-- Card Footer -->

                    <svg width="100" height="100" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="60" cy="60" r="60" fill="#1F82BD" fill-opacity="0.2" />
                        <path d="M53.5251 29.5251C54.1815 28.8687 55.0717 28.5 56 28.5H64C64.9283 28.5 65.8185 28.8687 66.4749 29.5251C67.1313 30.1815 67.5 31.0717 67.5 32C67.5 32.9283 67.1313 33.8185 66.4749 34.4749C65.8185 35.1313 64.9283 35.5 64 35.5H56C55.0717 35.5 54.1815 35.1313 53.5251 34.4749C52.8687 33.8185 52.5 32.9283 52.5 32C52.5 31.0717 52.8687 30.1815 53.5251 29.5251Z"
                              fill="#1F82BD" stroke="#1F82BD" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                              d="M36 40C36 37.8783 36.8429 35.8434 38.3431 34.3431C39.8434 32.8429 41.8783 32 44 32C44 35.1826 45.2643 38.2348 47.5147 40.4853C49.7652 42.7357 52.8174 44 56 44H64C67.1826 44 70.2348 42.7357 72.4853 40.4853C74.7357 38.2348 76 35.1826 76 32C78.1217 32 80.1566 32.8429 81.6569 34.3431C83.1571 35.8434 84 37.8783 84 40V84C84 86.1217 83.1571 88.1566 81.6569 89.6569C80.1566 91.1571 78.1217 92 76 92H44C41.8783 92 39.8434 91.1571 38.3431 89.6569C36.8429 88.1566 36 86.1217 36 84V40ZM48 56C46.9391 56 45.9217 56.4214 45.1716 57.1716C44.4214 57.9217 44 58.9391 44 60C44 61.0609 44.4214 62.0783 45.1716 62.8284C45.9217 63.5786 46.9391 64 48 64H48.04C49.1009 64 50.1183 63.5786 50.8684 62.8284C51.6186 62.0783 52.04 61.0609 52.04 60C52.04 58.9391 51.6186 57.9217 50.8684 57.1716C50.1183 56.4214 49.1009 56 48.04 56H48ZM60 56C58.9391 56 57.9217 56.4214 57.1716 57.1716C56.4214 57.9217 56 58.9391 56 60C56 61.0609 56.4214 62.0783 57.1716 62.8284C57.9217 63.5786 58.9391 64 60 64H72C73.0609 64 74.0783 63.5786 74.8284 62.8284C75.5786 62.0783 76 61.0609 76 60C76 58.9391 75.5786 57.9217 74.8284 57.1716C74.0783 56.4214 73.0609 56 72 56H60ZM48 72C46.9391 72 45.9217 72.4214 45.1716 73.1716C44.4214 73.9217 44 74.9391 44 76C44 77.0609 44.4214 78.0783 45.1716 78.8284C45.9217 79.5786 46.9391 80 48 80H48.04C49.1009 80 50.1183 79.5786 50.8684 78.8284C51.6186 78.0783 52.04 77.0609 52.04 76C52.04 74.9391 51.6186 73.9217 50.8684 73.1716C50.1183 72.4214 49.1009 72 48.04 72H48ZM60 72C58.9391 72 57.9217 72.4214 57.1716 73.1716C56.4214 73.9217 56 74.9391 56 76C56 77.0609 56.4214 78.0783 57.1716 78.8284C57.9217 79.5786 58.9391 80 60 80H72C73.0609 80 74.0783 79.5786 74.8284 78.8284C75.5786 78.0783 76 77.0609 76 76C76 74.9391 75.5786 73.9217 74.8284 73.1716C74.0783 72.4214 73.0609 72 72 72H60Z"
                              fill="#1F82BD" />
                    </svg>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-2 mt-4 w-full md:grid-cols-2 ">

                <!-- Product Section -->
                <div class="mb-4 p-4 bg-white rounded-lg shadow sm:p-6 xl:p-8 dark:bg-gray-800">
                    <!-- Card Title -->
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3 class=" text-xl font-bold text-gray-900 dark:text-white">
                                Loan Account
                            </h3>

                        </div>
                        <div class="flex-shrink-0">
                            <NavLink href="/account/loanproductsapplications"
                                     class="p-2 text-sm font-medium rounded-lg text-primary-700 hover:bg-gray-100 dark:text-primary-500 dark:hover:bg-gray-700">
                                See
                                all
                            </NavLink><svg class="inline ml-1" width="20" height="20" viewBox="0 0 20 20" fill="none"
                                           xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.5 4.1665L13.3333 9.99984L7.5 15.8332" stroke="#1F82BD" stroke-width="2"
                                      stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </div>
                    </div>

                    <div class=" pt-6">

                        @if (_LoanAccountMasterView.Count < 1)
                        {
                            <p>You have 0 loan request <a href="/account/loanproductApplication" class="@Tailwind.Button_Green">Apply now</a></p>
                        }

                        @foreach (var loan in _LoanAccountMasterView.Take(5))
                        {
                            <br>

                            <div class="flex items-center justify-between pb-3 border-b border-b-2">
                                <div class="flex items-start gap-2 justify-center ">

                                    @((MarkupString)@SvgHelpers.LoanAndDepositIcon)

                                    <div class="flex flex-col items-start justify-center">
                                        <a>
                                            <h5 class=" text-base font-semibold tracking-tight text-gray-900 dark:text-white">
                                                Executive loan account
                                            </h5>
                                        </a>
                                        <p class=" font-normal text-sm leading-6 text-gray-500 dark:text-gray-400">
                                            @loan.AccountNo
                                        </p>
                                    </div>

                                </div>
                                <div>
                                    <a class="inline-flex items-center text-black hover:underline font-semibold">
                                        @loan.PrincipalBalanceAccountId_LedgerBalance.ToString("N2")
                                    </a>
                                </div>
                            </div>
                        }


                    </div>

                </div>

                <!-- Product Section -->
                <div class="mb-4 p-4 bg-white rounded-lg shadow sm:p-6 xl:p-8 dark:bg-gray-800">
                    <!-- Card Title -->
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3 class=" text-xl font-bold text-gray-900 dark:text-white">
                                Deposit Account
                            </h3>

                        </div>
                        <div class="flex-shrink-0">
                            <NavLink href="/account/DepositAccount"
                                     class="p-2 text-sm font-medium rounded-lg text-primary-700 hover:bg-gray-100 dark:text-primary-500 dark:hover:bg-gray-700">
                                See all
                            </NavLink>
                            <svg class="inline ml-1" width="20" height="20" viewBox="0 0 20 20" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.5 4.1665L13.3333 9.99984L7.5 15.8332" stroke="#1F82BD" stroke-width="2"
                                      stroke-linecap="round" stroke-linejoin="round" />
                            </svg>

                        </div>
                    </div>

                    <div class=" pt-6">

                        @if (_DepositAccountsMasterViewSrc.Count < 1)
                        {
                            <p>You have 0 account <a href="/account/newdepositapplication" class="@Tailwind.Button_Green">Apply now</a></p>
                        }

                        @foreach (var deposit in _DepositAccountsMasterViewSrc.Take(5))
                        {
                            <br>

                            <div class="flex items-center justify-between pb-3 border-b border-b-2">
                                
                                <div class="flex items-start gap-2 justify-center pb-3">
                                    
                                    @((MarkupString)@SvgHelpers.LoanAndDepositIcon)

                                    <div class="flex flex-col items-start justify-center">
                                        <a href="/DepositAccountDetails/@deposit.AccountType.ToLower()/@deposit.Id/@deposit.CustomerId">
                                            <h5 class=" text-base font-semibold tracking-tight text-gray-900 dark:text-white">
                                                @deposit.AccountType.ToString().Replace("_", " ")
                                            </h5>
                                        </a>
                                        <p class=" font-normal text-sm leading-6 text-gray-500 dark:text-gray-400">
                                            @deposit.AccountNo
                                        </p>
                                    </div>
                                </div>

                                <div>
                                    <a href="/DepositAccountDetails/@deposit.AccountType.ToLower()/@deposit.Id/@deposit.CustomerId" class="inline-flex items-center text-black hover:underline font-semibold">
                                        @deposit.LedgerBalance.ToString("N2")
                                    </a>
                                </div>
                            </div>
                        }

                    </div>

                </div>

            </div>

            <div class="p-4 bg-white rounded-lg shadow sm:p-6 xl:p-8 dark:bg-gray-800">
                <!-- Card Title -->
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">
                            Request
                        </h3>
                        <span class="text-base font-normal text-gray-500 dark:text-gray-400">
                            All Current Request from loan and Deposit products
                        </span>
                    </div>
                    <div class="flex-shrink-0">
                    </div>
                </div>
                <!-- Table -->
                <div class="flex flex-col mt-8">
                    <div class="overflow-x-auto rounded-lg">
                        <div class="inline-block min-w-full align-middle">
                            <div class="overflow-hidden shadow sm:rounded-lg">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col"
                                                class="p-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase dark:text-white">
                                                Description
                                            </th>
                                            <th scope="col"
                                                class="p-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase dark:text-white">
                                                Date
                                            </th>
                                            <th scope="col"
                                                class="p-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase dark:text-white">
                                                Amount
                                            </th>
                                            <th scope="col"
                                                class="p-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase dark:text-white">
                                                Status
                                            </th>

                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800">

                                        @foreach (var (item, index) in _LoanAndDepositRequestMasterView.OrderByDescending(x => x.DateCreated).Select((value, i) => (value, i)).Take(10))
                                        {
                                            <tr class="@GetGridItemClass(index)">
                                                <td class="p-4 text-sm font-normal text-gray-900 whitespace-nowrap dark:text-white">
                                                    @item.Description
                                                    <span class="font-semibold">@item.IsLoanOrProduct</span>
                                                </td>
                                                <td class="p-4 text-sm font-normal text-gray-500 whitespace-nowrap dark:text-gray-400">
                                                    @item.DateCreated
                                                </td>
                                                <td class="p-4 text-sm font-semibold text-gray-900 whitespace-nowrap dark:text-white">
                                                    @item.Amount.ToString("N0")
                                                </td>
                                                <td class="p-4 whitespace-nowrap">
                                                   
                                                        <ApprovalStatusComp approvalName="@item.Status"></ApprovalStatusComp>
                                                   
                                                </td>

                                            </tr>
                                        }


                                    </tbody>
                                </table>


                            </div>
                        </div>
                    </div>
                </div>

            </div>

        }

    </div>



</main>



@if (showCashAdditionDrawal)
{
    bool showAccount = false;

    <SavingsCashAdditionComp showAddDrawer="@showAddDrawal"
                             CustomerID="@CustomerId"
                             SavingsAccountNumber=""
                             MembersName="@_GetCustomerMasterView.FullName"
                             showDepositAccountMasterView=@showAccount
                             MembersNumber="@_GetCustomerMasterView.MemberId"
                             OnUpdateChanged="@OnUpdateChangedHandler" />
}
